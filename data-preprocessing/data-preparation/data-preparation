import pandas as pd
from sklearn.preprocessing import StandardScaler

# Load the data
df = pd.read_csv('../spotify_data.csv')

# Extract spotify features
features = ['danceability', 'energy', 'speechiness', 'acousticness', 'valence', 'instrumentalness']
data_continuous = df[features]

# Scale features
scaler = StandardScaler()
data_scaled = scaler.fit_transform(data_continuous)

# Combine genre embeddings with scaled features
genre_embeddings = pd.read_csv('../genre_embeddings.csv').set_index('Genre').to_dict()['Embedding']
df['genre_embedding'] = df['genre'].apply(lambda x: genre_embeddings.get(x, [0]*len(genre_embeddings[list(genre_embeddings.keys())[0]])))

# Convert string representation of list to actual list
df['genre_embedding'] = df['genre_embedding'].apply(lambda x: eval(x) if isinstance(x, str) else x)


# Convert the embedding list to individual columns
embedding_df = pd.DataFrame(df['genre_embedding'].tolist(), columns=[f'embed_{i}' for i in range(len(df['genre_embedding'].iloc[0]))])

# Combine the scaled continuous data with the embeddings
data_combined = pd.concat([df, embedding_df], axis=1)

# save the data to a csv
data_combined.to_csv('spotify_data_processed.csv', index=False)
